import{f as U,a as S,c as ne}from"../chunks/CqfPujLJ.js";import"../chunks/dDVp0x_e.js";import{I as be,N as ct,p as ye,q as K,v as xe,w as g,x as T,y as m,g as e,m as C,s as r,k as _e,a9 as he,h as Te,o as De,a_ as ke,b as y,A as ee}from"../chunks/DhgA-MYx.js";import{e as z,s as Ue}from"../chunks/GTjz6jRx.js";import{t as lt,s as V,a as Ge,d as qe,e as dt,r as ut}from"../chunks/3RfNQFC1.js";import{i as Ae}from"../chunks/BxwXIULK.js";import{s as Ne,a as ze}from"../chunks/Bgr80FTy.js";import{s as vt}from"../chunks/Cy5JWnj6.js";import{d as Le}from"../chunks/D7FRHPeW.js";import{o as Oe,a as ft}from"../chunks/U2GiaHM_.js";import{i as M}from"../chunks/CeyXQqgm.js";import{b as pt,G as gt}from"../chunks/z1_75_LT.js";import{p as j,b as te}from"../chunks/EsF0eeuf.js";import{G as mt}from"../chunks/DFqi5821.js";import{C as bt}from"../chunks/CFNrZGOd.js";function _t(d,v,x,R,w){var c;be&&ct();var _=(c=v.$$slots)==null?void 0:c[x],f=!1;_===!0&&(_=v.children,f=!0),_===void 0||_(d,f?()=>R:R)}function ht(d,v,x,R){var w=d.__style;if(be||w!==v){var _=lt(v);(!be||_!==d.getAttribute("style"))&&(_==null?d.removeAttribute("style"):d.style.cssText=_),d.__style=v}return R}const yt=()=>{const d=vt;return{page:{subscribe:d.page.subscribe},navigating:{subscribe:d.navigating.subscribe},updated:d.updated}},Me={subscribe(d){return yt().page.subscribe(d)}};var xt=U('<nav class="navbar svelte-rfuq4y" aria-label="NavegaciÃ³n principal"><div class="navbar-content svelte-rfuq4y"><div class="navbar-brand-section svelte-rfuq4y"><a class="navbar-item marca svelte-rfuq4y" href="/"><img src="/brand/Logo_SIGA.png" alt="Logo de SIGA - Volver al inicio" class="marca-logo svelte-rfuq4y"/></a></div> <div class="navbar-menu-section svelte-rfuq4y" id="navbar-menu"><a href="/">Inventario</a> <a href="/analisis">AnÃ¡lisis</a> <a href="/acerca">Acerca de</a></div> <button type="button" class="navbar-burger" aria-label="Abrir menÃº" aria-expanded="false"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></button></div></nav>');function At(d,v){ye(v,!1);const x=()=>ze(_,"$rutaActual",R),[R,w]=Ne(),_=Le(Me,u=>u.url.pathname);let f=!1;const c=(u,n)=>u===n,b=u=>{const n=document.getElementById("navbar-menu"),D=u.currentTarget;f=!f,D.setAttribute("aria-expanded",f?"true":"false"),D.classList.toggle("is-active"),n==null||n.classList.toggle("is-active")},h=()=>{if(f){f=!1;const u=document.getElementById("navbar-menu"),n=document.querySelector(".navbar-burger");n==null||n.setAttribute("aria-expanded","false"),n==null||n.classList.remove("is-active"),u==null||u.classList.remove("is-active")}};Ae();var L=xt(),O=g(L),G=T(g(O),2),l=g(G),E=T(l,2),I=T(E,2);m(G);var q=T(G,2);m(O),m(L),K((u,n,D)=>{V(l,1,u,"svelte-rfuq4y"),V(E,1,n,"svelte-rfuq4y"),V(I,1,D,"svelte-rfuq4y")},[()=>`navbar-item enlace ${c("/",x())?"is-active":""}`,()=>`navbar-item enlace ${c("/analisis",x())?"is-active":""}`,()=>`navbar-item enlace ${c("/acerca",x())?"is-active":""}`]),z("click",l,h),z("click",E,h),z("click",I,h),z("click",q,b),S(d,L),xe(),w()}var St=U('<div class="contenedor-grafico svelte-1t5ifg9"><canvas></canvas></div>');function Ct(d,v){ye(v,!1);let x=j(v,"titulo",8,""),R=j(v,"etiquetas",24,()=>[]),w=j(v,"valores",24,()=>[]),_=j(v,"colorLinea",8,null),f=j(v,"colorRelleno",8,null),c=C(),b=C();const h=(l,E=1)=>{const I=l.replace("#","").trim(),n=(I.length===3?I.split("").map(ae=>`${ae}${ae}`).join(""):I).padEnd(6,"0"),D=parseInt(n.slice(0,2),16),k=parseInt(n.slice(2,4),16),A=parseInt(n.slice(4,6),16);return`rgba(${D}, ${k}, ${A}, ${E})`},L=(l,E)=>typeof document>"u"?E:getComputedStyle(document.documentElement).getPropertyValue(l).trim()||E;Oe(()=>{if(!e(c))return;const l=typeof document<"u"&&getComputedStyle(document.documentElement).getPropertyValue("--color-texto")||"#2c3e50",E=_()||L("--color-secundario","#00b4d8"),I=f()||L("--color-secundario","#00b4d8"),q=e(c);r(b,new bt(q,{type:"line",data:{labels:R(),datasets:[{label:x(),data:w(),borderColor:E,backgroundColor:h(I,.1),fill:!0,tension:.4,pointRadius:5,pointBackgroundColor:E,pointBorderColor:"#ffffff",pointBorderWidth:2,pointHoverRadius:7,borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{position:"top",labels:{color:l,usePointStyle:!0}},title:{display:!!x(),text:x(),color:l,font:{size:14}}},scales:{y:{beginAtZero:!0,ticks:{color:l},grid:{color:h(l,.1)}},x:{ticks:{color:l},grid:{display:!1}}}}}))}),ft(()=>{var l;(l=e(b))==null||l.destroy()}),_e(()=>(e(b),Te(R()),Te(w())),()=>{e(b)&&(he(b,e(b).data.labels=[...R()]),he(b,e(b).data.datasets[0].data=[...w()]),e(b).update())}),De(),Ae();var O=St(),G=g(O);te(G,l=>r(c,l),()=>e(c)),m(O),K(()=>Ge(G,"aria-label",x())),S(d,O),xe()}var Rt=U('<div class="mensaje-bienvenida svelte-e2cix7"><p class="svelte-e2cix7"><strong class="svelte-e2cix7">Â¡Hola! ğŸ‘‹</strong></p> <p class="svelte-e2cix7">Soy tu asistente SIGA. Puedo ayudarte con:</p> <ul class="bienvenida-lista svelte-e2cix7"><li class="svelte-e2cix7">ğŸ“Š AnÃ¡lisis de ventas y tendencias</li> <li class="svelte-e2cix7">ğŸ“¦ Consultas sobre inventario</li> <li class="svelte-e2cix7">âš ï¸ Alertas de stock crÃ­tico</li> <li class="svelte-e2cix7">ğŸ’¡ Recomendaciones de gestiÃ³n</li></ul> <p class="hint svelte-e2cix7">Escribe tu pregunta o usa el micrÃ³fono ğŸ¤</p></div>'),Et=U('<div><p class="svelte-e2cix7"> </p></div>'),wt=U('<div class="grafico-contenedor svelte-e2cix7"><!></div>'),It=U('<div class="grafico-contenedor svelte-e2cix7"><!></div>'),Tt=U('<div class="grafico-contenedor svelte-e2cix7"><!></div>'),kt=U('<div class="mensaje siga grafico-mensaje svelte-e2cix7"><!></div>'),Ut=U('<div class="mensaje siga svelte-e2cix7"><p class="pensando svelte-e2cix7"><span class="svelte-e2cix7"></span> <span class="svelte-e2cix7"></span> <span class="svelte-e2cix7"></span></p></div>'),qt=U('<div class="mensaje error svelte-e2cix7"><p class="svelte-e2cix7"> </p></div>'),Dt=U('<div class="panel-asistente svelte-e2cix7"><div class="panel-header svelte-e2cix7" role="application"><h3 class="svelte-e2cix7">ğŸ¤– SIGA Asistente</h3> <button type="button" title="Usar micrÃ³fono">ğŸ¤</button></div> <div class="mensajes-area svelte-e2cix7"><!> <!> <!> <!></div> <form class="input-area svelte-e2cix7"><div class="input-group svelte-e2cix7"><input type="text" placeholder="Escribe o usa micrÃ³fono..." class="mensaje-input svelte-e2cix7"/> <button type="submit" class="enviar-btn svelte-e2cix7" aria-label="Enviar mensaje">â†’</button></div></form></div>'),Gt=U('<div><button title="Asistente contextual de SIGA"><img src="/S.png" alt="SIGA" class="siga-logo svelte-e2cix7"/></button> <!></div>');function Nt(d,v){ye(v,!1);const x=()=>ze(ae,"$rutaActual",R),[R,w]=Ne(),_=C();let f=C(!1),c=C(""),b=C(!1),h=C(""),L=C(0),O=C(0),G=C(!1),l=0,E=0,I=C(),q=C(),u=C(),n=C(),D=C(!1),k,A=C([]);const ae=Le(Me,t=>t.url.pathname),$e=()=>{if(!e(I))return;const t=e(I).getBoundingClientRect(),o=380,i=500;let p=t.left-o-20,N=t.top;p<0&&(p=t.right+20),N+i>window.innerHeight&&(N=window.innerHeight-i-20),r(L,Math.max(0,p)),r(O,Math.max(0,N))},Be=()=>{r(f,!e(f)),e(f)&&setTimeout($e,0)},Pe=async t=>{try{if(t.accion==="crear_producto"){const i=await(await fetch("/api/productos/crear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nombre:t.nombre,categoria:t.categoria,sku:t.sku})})).json();i.success&&i.datos&&(console.log("âœ… Producto creado:",i.producto),qe.set(i.datos))}else if(t.accion==="agregar_stock"||t.accion==="reducir_stock"){const i=await(await fetch("/api/inventario/actualizar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({producto:t.producto,local:t.local,cantidad:t.cantidad,accion:t.accion==="agregar_stock"?"agregar":"reducir"})})).json();i.success&&i.datos&&(console.log("âœ… Stock actualizado:",i.mensaje),qe.set(i.datos))}}catch(o){console.error("Error procesando CRUD:",o)}},Se=async()=>{const t=e(c).trim();if(t){r(A,[...e(A),{id:crypto.randomUUID(),emisor:"usuario",tipo:"texto",contenido:t}]),r(c,""),r(b,!0),r(h,"");try{const o=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mensaje:e(_)+t})});if(!o.ok)throw new Error("No fue posible conectar con SIGA.");const p=(await o.json()).respuesta??"Estoy aquÃ­ para ayudarte.";p.includes("[GRAFICO_TORTA]")?r(A,[...e(A),{id:crypto.randomUUID(),emisor:"siga",tipo:"grafico",grafico:{tipo:"torta",titulo:"DistribuciÃ³n de mermas por categorÃ­a",etiquetas:["LÃ¡cteos","Bebidas","Snacks","SÃ¡ndwiches"],valores:[12,5,4,3]}}]):p.includes("[GRAFICO_BARRAS]")?r(A,[...e(A),{id:crypto.randomUUID(),emisor:"siga",tipo:"grafico",grafico:{tipo:"barras",titulo:"Ventas por categorÃ­a",etiquetas:["LÃ¡cteos","Bebidas","Snacks","SÃ¡ndwiches"],valores:[45,62,38,24]}}]):p.includes("[GRAFICO_LINEAS]")&&r(A,[...e(A),{id:crypto.randomUUID(),emisor:"siga",tipo:"grafico",grafico:{tipo:"lineas",titulo:"Tendencia de ventas por dÃ­a",etiquetas:["Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b","Dom"],valores:[124,132,118,156,189,241,203]}}]);const N=p.replace(/\[CRUD_START\][\s\S]*?\[CRUD_END\]/g,"").replace("[GRAFICO_TORTA]","").replace("[GRAFICO_BARRAS]","").replace("[GRAFICO_LINEAS]","").trim(),$=p.match(/\[CRUD_START\]([\s\S]*?)\[CRUD_END\]/g);if($&&$.length>0)for(const oe of $){const ie=oe.replace(/\[CRUD_START\]|\[CRUD_END\]/g,"").trim();try{const B=JSON.parse(ie);await Pe(B),console.log("âœ… CRUD procesado:",B.accion)}catch(B){console.error("Error parsando CRUD:",B,"Contenido:",ie)}}N&&r(A,[...e(A),{id:crypto.randomUUID(),emisor:"siga",tipo:"texto",contenido:N}])}catch(o){console.error(o),r(h,"No pudimos obtener la respuesta. Intenta nuevamente.")}finally{r(b,!1),setTimeout(()=>{e(n)&&e(n).focus()},100)}}},Ce=async t=>{t.preventDefault(),await Se()},Ve=t=>{if(t.button!==0||(r(G,!0),!e(q)))return;const o=e(q).getBoundingClientRect();l=t.clientX-o.left,E=t.clientY-o.top,console.log("âœ‹ Arrastrando iniciado en:",l,E)},Fe=t=>{if(!e(G)||!e(q))return;const o=t.clientX-l,i=t.clientY-E,p=window.innerWidth-e(q).offsetWidth,N=window.innerHeight-e(q).offsetHeight;r(L,Math.max(0,Math.min(o,p))),r(O,Math.max(0,Math.min(i,N)))},He=()=>{r(G,!1)},Re=()=>{const t=window.webkitSpeechRecognition||window.SpeechRecognition;if(!t){r(h,"âŒ Tu navegador no soporta entrada de voz. Usa Chrome, Edge o Safari.");return}try{k=new t,k.lang="es-ES",k.continuous=!1,k.interimResults=!1,k.onstart=()=>{r(D,!0),r(h,"")},k.onresult=o=>{let i="";for(let p=o.resultIndex;p<o.results.length;p++)o.results[p].isFinal&&(i+=o.results[p][0].transcript);i&&(r(c,i),r(D,!1),setTimeout(()=>{e(c).trim()&&Se()},2e3))},k.onerror=o=>{console.error("Error de voz:",o.error),r(D,!1);let i="âŒ Error desconocido. Intenta de nuevo.";o.error==="network"?i="ğŸŒ Error de conexiÃ³n. Verifica tu internet.":o.error==="audio"?i="ğŸ¤ No se detectÃ³ audio. Verifica tu micrÃ³fono.":o.error==="not-allowed"?i="ğŸ”’ Permiso negado. Autoriza el micrÃ³fono.":o.error==="no-speech"?i="ğŸ¤ No se detectÃ³ voz. Intenta de nuevo.":o.error==="bad-grammar"?i="ğŸ“ Error en el reconocimiento. Intenta de nuevo.":o.error==="service-not-allowed"&&(i="â›” El servicio de voz no estÃ¡ disponible."),r(h,i)},k.onend=()=>{r(D,!1)}}catch(o){console.error("Error al inicializar voz:",o),r(h,"âŒ Error al inicializar el micrÃ³fono.")}},Je=()=>{if(r(h,""),k||Re(),k)try{r(h,"ğŸ¤ Escuchando... habla ahora"),k.start()}catch(t){console.error("Error al iniciar grabaciÃ³n:",t),r(h,"âŒ No se pudo iniciar la grabaciÃ³n. Intenta de nuevo.")}};Oe(()=>{Re()}),_e(()=>x(),()=>{r(_,(()=>{const t=x();return t==="/"?"El usuario estÃ¡ viendo el inventario. ":t==="/analisis"?"El usuario estÃ¡ viendo anÃ¡lisis de ventas. ":t==="/acerca"?"El usuario estÃ¡ leyendo sobre SIGA. ":""})())}),_e(()=>(e(u),e(A)),()=>{e(u)&&e(A).length&&setTimeout(()=>{e(u)&&he(u,e(u).scrollTop=e(u).scrollHeight)},50)}),De(),Ae();var re=Gt();z("mousemove",ke,Fe),z("mouseup",ke,He);var Z=g(re);let Ee;te(Z,t=>r(I,t),()=>e(I));var Xe=T(Z,2);{var Ye=t=>{var o=Dt(),i=g(o),p=T(g(i),2);let N;m(i);var $=T(i,2),oe=g($);{var ie=s=>{var a=Rt();S(s,a)};M(oe,s=>{e(A),y(()=>e(A).length===0)&&s(ie)})}var B=T(oe,2);dt(B,1,()=>e(A),s=>s.id,(s,a)=>{var Q=ne(),le=ee(Q);{var je=H=>{var P=Et(),se=g(P),de=g(se,!0);m(se),m(P),K(()=>{V(P,1,(e(a),y(()=>`mensaje ${e(a).emisor}`)),"svelte-e2cix7"),Ue(de,(e(a),y(()=>e(a).contenido)))}),S(H,P)},et=H=>{var P=ne(),se=ee(P);{var de=ue=>{var ve=kt(),tt=g(ve);{var at=J=>{var X=wt(),fe=g(X);gt(fe,{get titulo(){return e(a),y(()=>e(a).grafico.titulo)},get etiquetas(){return e(a),y(()=>e(a).grafico.etiquetas)},get valores(){return e(a),y(()=>e(a).grafico.valores)}}),m(X),S(J,X)},rt=J=>{var X=ne(),fe=ee(X);{var ot=Y=>{var W=It(),pe=g(W);mt(pe,{get titulo(){return e(a),y(()=>e(a).grafico.titulo)},get etiquetas(){return e(a),y(()=>e(a).grafico.etiquetas)},get valores(){return e(a),y(()=>e(a).grafico.valores)}}),m(W),S(Y,W)},it=Y=>{var W=ne(),pe=ee(W);{var st=ge=>{var me=Tt(),nt=g(me);Ct(nt,{get titulo(){return e(a),y(()=>e(a).grafico.titulo)},get etiquetas(){return e(a),y(()=>e(a).grafico.etiquetas)},get valores(){return e(a),y(()=>e(a).grafico.valores)}}),m(me),S(ge,me)};M(pe,ge=>{e(a),y(()=>e(a).grafico.tipo==="lineas")&&ge(st)},!0)}S(Y,W)};M(fe,Y=>{e(a),y(()=>e(a).grafico.tipo==="barras")?Y(ot):Y(it,!1)},!0)}S(J,X)};M(tt,J=>{e(a),y(()=>e(a).grafico.tipo==="torta")?J(at):J(rt,!1)})}m(ve),S(ue,ve)};M(se,ue=>{e(a),y(()=>e(a).tipo==="grafico"&&e(a).grafico)&&ue(de)},!0)}S(H,P)};M(le,H=>{e(a),y(()=>e(a).tipo==="texto")?H(je):H(et,!1)})}S(s,Q)});var we=T(B,2);{var We=s=>{var a=Ut();S(s,a)};M(we,s=>{e(b)&&s(We)})}var Ke=T(we,2);{var Ze=s=>{var a=qt(),Q=g(a),le=g(Q,!0);m(Q),m(a),K(()=>Ue(le,e(h))),S(s,a)};M(Ke,s=>{e(h)&&s(Ze)})}m($),te($,s=>r(u,s),()=>e(u));var ce=T($,2),Ie=g(ce),F=g(Ie);ut(F),te(F,s=>r(n,s),()=>e(n));var Qe=T(F,2);m(Ie),m(ce),m(o),te(o,s=>r(q,s),()=>e(q)),K(s=>{ht(o,`left: ${e(L)??""}px; top: ${e(O)??""}px; cursor: ${e(G)?"grabbing":"default"}`),N=V(p,1,"btn-voz-header svelte-e2cix7",null,N,{activo:e(D)}),p.disabled=e(b),F.disabled=e(b),Qe.disabled=s},[()=>(e(b),e(c),y(()=>e(b)||!e(c).trim()))]),z("click",p,Je),z("mousedown",i,Ve),pt(F,()=>e(c),s=>r(c,s)),z("keydown",F,s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Ce(s))}),z("submit",ce,Ce),S(t,o)};M(Xe,t=>{e(f)&&t(Ye)})}m(re),K(()=>{V(re,1,`asistente-contextual ${e(f)?"is-open":""}`,"svelte-e2cix7"),Ee=V(Z,1,"toggle-asistente svelte-e2cix7",null,Ee,{abierto:e(f)}),Ge(Z,"aria-label",e(f)?"Cerrar asistente":"Abrir asistente")}),z("click",Z,Be),S(d,re),xe(),w()}var zt=U('<!> <main class="section"><div class="container"><!></div></main> <!>',1);function Qt(d,v){var x=zt(),R=ee(x);At(R,{});var w=T(R,2),_=g(w),f=g(_);_t(f,v,"default",{}),m(_),m(w);var c=T(w,2);Nt(c,{}),S(d,x)}export{Qt as component};

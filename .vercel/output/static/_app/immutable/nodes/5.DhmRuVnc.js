import{f,a as v,c as C}from"../chunks/CqfPujLJ.js";import"../chunks/dDVp0x_e.js";import{p as re,k as ie,o as le,q as $,g as s,v as ne,w as t,x as d,s as r,m as p,y as o,A as R,b as u,B}from"../chunks/DhgA-MYx.js";import{e as F,s as J}from"../chunks/GTjz6jRx.js";import{i as z}from"../chunks/CeyXQqgm.js";import{e as ve,d as ce,r as de,s as ue}from"../chunks/3RfNQFC1.js";import{b as me,G as pe}from"../chunks/z1_75_LT.js";import{i as fe}from"../chunks/BxwXIULK.js";import{s as be,a as _e}from"../chunks/Bgr80FTy.js";var ge=f('<div><p class="svelte-1ul3blz"> </p></div>'),ye=f('<div class="mensaje es-siga svelte-1ul3blz"><p class="mb-3 svelte-1ul3blz">Aquí tienes el panorama de mermas por categoría:</p> <!></div>'),ze=f('<div class="mensaje es-siga pensando svelte-1ul3blz"><span class="loader svelte-1ul3blz"></span> <span class="svelte-1ul3blz">SIGA está pensando...</span></div>'),he=f('<div class="notification is-danger mt-4 svelte-1ul3blz"> </div>'),xe=f('<section class="section svelte-1ul3blz"><div class="box svelte-1ul3blz"><h1 class="title has-text-weight-semibold svelte-1ul3blz">Asistente con IA</h1> <p class="subtitle svelte-1ul3blz">Pregunta lo que necesites. SIGA usa IA real para recomendaciones sin esperas.</p> <div class="chat-container svelte-1ul3blz"><div class="mensajes svelte-1ul3blz"><!> <!> <!></div> <form class="formulario svelte-1ul3blz"><div class="field has-addons svelte-1ul3blz"><div class="control is-expanded svelte-1ul3blz"><input class="input is-medium svelte-1ul3blz" type="text" placeholder="Escribe tu consulta..."/></div> <div class="control svelte-1ul3blz"><button class="button is-link is-medium svelte-1ul3blz" type="submit">Enviar</button></div></div></form></div></div></section>');function Ge(K,H){re(H,!1);const D=()=>_e(ce,"$datosNegocio",L),[L,Q]=be(),h=p();let b=p(""),l=p([]),_=p(!1),g=p("");const G=()=>{const e=s(h).map(i=>i.categoria),a=s(h).map(i=>i.cantidad);return{etiquetas:e,valores:a}},M=async()=>{const e=s(b).trim();if(e){r(l,[...s(l),{id:crypto.randomUUID(),emisor:"usuario",tipo:"texto",contenido:e}]),r(b,""),r(_,!0),r(g,"");try{const a=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mensaje:e})});if(!a.ok)throw new Error("No fue posible conectar con SIGA. Intenta nuevamente.");const m=(await a.json()).respuesta??"";typeof m=="string"&&m.includes("[GRAFICO_MERMAS]")?r(l,[...s(l),{id:crypto.randomUUID(),emisor:"siga",tipo:"grafico-mermas"}]):r(l,[...s(l),{id:crypto.randomUUID(),emisor:"siga",tipo:"texto",contenido:m||"Estoy aquí para ayudarte."}])}catch(a){console.error(a),r(g,"No pudimos obtener la respuesta. Por favor, revisa tu conexión o inténtalo más tarde.")}finally{r(_,!1)}}},V=async e=>{e.preventDefault(),await M()};ie(()=>D(),()=>{r(h,D().mermasMes??[])}),le(),fe();var x=xe(),N=t(x),S=d(t(N),4),A=t(S),j=t(A);ve(j,1,()=>s(l),e=>e.id,(e,a)=>{var i=C(),m=R(i);{var ee=c=>{var n=ge(),y=t(n),E=t(y,!0);o(y),o(n),$(()=>{ue(n,1,(s(a),u(()=>`mensaje ${s(a).emisor==="usuario"?"es-usuario":"es-siga"}`)),"svelte-1ul3blz"),J(E,(s(a),u(()=>s(a).contenido)))}),v(c,n)},se=c=>{var n=C(),y=R(n);{var E=k=>{var U=ye(),ae=d(t(U),2);{let te=B(()=>u(()=>G().etiquetas)),oe=B(()=>u(()=>G().valores));pe(ae,{titulo:"Mermas mensuales por categoría",get etiquetas(){return s(te)},get valores(){return s(oe)}})}o(U),v(k,U)};z(y,k=>{s(a),u(()=>s(a).tipo==="grafico-mermas")&&k(E)},!0)}v(c,n)};z(m,c=>{s(a),u(()=>s(a).tipo==="texto")?c(ee):c(se,!1)})}v(e,i)});var P=d(j,2);{var W=e=>{var a=ze();v(e,a)};z(P,e=>{s(_)&&e(W)})}var X=d(P,2);{var Y=e=>{var a=he(),i=t(a,!0);o(a),$(()=>J(i,s(g))),v(e,a)};z(X,e=>{s(g)&&e(Y)})}o(A);var I=d(A,2),O=t(I),q=t(O),w=t(q);de(w),o(q);var T=d(q,2),Z=t(T);o(T),o(O),o(I),o(S),o(N),o(x),$(()=>Z.disabled=s(_)),me(w,()=>s(b),e=>r(b,e)),F("keydown",w,e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),M())}),F("submit",I,V),v(K,x),ne(),Q()}export{Ge as component};
